<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Learning to Explain Chatbot</title>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" rel="stylesheet">
      <link href="{{ url_for('static', filename='stylesheets/chat.css') }}" rel="stylesheet">

</head>
<body>

<!-- Chat interface. Original source: https://bootsnipp.com/snippets/1ea0N -->

<div class="container">
  <br>
<h1 class=" text-center main-title">Learning to Explain without Structured Knowledge</h1>
<br>
  <div class="row justify-content-md-center">
      <div class="col-10">
    <h2>About L2E</h2>
    <p>Learning to provide plausible explanations is a challenging but critical goal for language based human-machine interaction because humans often demand explanations of the world.
  We contribute to the under-explored area of generating natural language explanations for general phenomena.
We automatically collect large datasets of explanation-phenomenon pairs, which allow us to train modern end-to-end models to generate natural language explanations.
We compare different training strategies and evaluate their performance using both automatic scores and human ratings.</p>
  </div>
  </div>
  <div class="row justify-content-md-center">
    <div class="col-10">
    <h2>About Demo</h2>
      <p>In the following demo, we showcase the ability of our Seq2Seq model L2E to answer generic why questions. Note that L2E is not a all-purpose chatbot
        and <strong>cannot</strong> answer general questions. We actively filter out any message that does not end with <strong>because</strong> or lead with <strong>Why</strong>.</p>
      <p>This demo model corresponds to the L2E-Seq2Seq Transformer model we discussed in the paper. The sampling is done with beam size 5 and no additional penalty on length and coverage.</p>
      <p>We provide a few examples below just to get you started: </p>

        <p><strong>Why is the boy crying?</strong></p>
        <p><strong>Why is the Earth round?</strong></p>
        <p><strong>Why does the garage door not open?</strong></p>
        <p> <strong>The large ball crashed right through the table because?</strong></p>
        <p> <strong>The man can not lift his son because?</strong></p>
        <p> <strong>He had to stand because?</strong></p>

        <p>We provide the sampled results from Winograd Schema Challenge clauses in our Jupyter Notebook here: <a href="https://nbviewer.jupyter.org/url/3.18.91.191/static/WinogradS2Generation.ipynb">Winograd Generation</a></p>
        <p>Seq2Seq models are known to be very brittle to small changes in languagae even though they are often trained on large corpora. The model might also generate discriminatory messages even though it is trained on
        properly published newspaper articles.</p>
        <p>We hope you enjoy this demo as it fills in a gap that currently most chitchat chatbots cannot even begin to answer why questions.</p>

      </div>
  </div>

  <div class="row justify-content-md-center">
    <div class="col-10 sep">
      <hr>
    </div>
  </div>

<h3 class="text-center banner-title">Demo</h3>
<div class="messaging">
      <div class="inbox_msg center-block">
        <div class="inbox_people">
          <div class="headind_srch">
            <div class="recent_heading">
              <h4>Recent</h4>
            </div>
            <div class="srch_bar">
              <div class="stylish-input-group">
                <input type="text" class="search-bar"  placeholder="Search" >
                <span class="input-group-addon">
                <button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
                </span> </div>
            </div>
          </div>
          <div class="inbox_chat">
            <div class="chat_list active_chat">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="profile"> </div>
                <div class="chat_ib">
                  <h5>L2E Why-bot <span class="chat_date" id="active_chat_date"></span></h5>
                  <p>Hello! Please ask me to explain something!</p>
                </div>
              </div>
            </div>
            <!--<div class="chat_list">-->
              <!--<div class="chat_people">-->
                <!--<div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="profile"> </div>-->
                <!--<div class="chat_ib">-->
                  <!--<h5>OpenSubtitle Chatbot <span class="chat_date">Dec 25</span></h5>-->
                  <!--<p>Test, which is a new approach to have all solutions-->
                    <!--astrology under one roof.</p>-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->
          </div>
        </div>
        <div class="mesgs">
          <div class="msg_history" id="msg_history_node">

            <!--<div class="incoming_msg">-->
              <!--<div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="profile"> </div>-->
              <!--<div class="received_msg">-->
                <!--<div class="received_withd_msg">-->
                  <!--<p>Hello! Please ask me to explain something!</p>-->
                  <!--<span class="time_date"> 11:01 AM    |    June 9</span></div>-->
              <!--</div>-->
            <!--</div>-->

            <!--<div class="outgoing_msg">-->
              <!--<div class="sent_msg">-->
                <!--<p>Test which is a new approach to have all-->
                  <!--solutions</p>-->
                <!--<span class="time_date"> 11:01 AM    |    June 9</span> </div>-->
            <!--</div>-->

            <!--<div class="incoming_msg">-->
              <!--<div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="profile"> </div>-->
              <!--<div class="received_msg">-->
                <!--<div class="received_withd_msg">-->
                  <!--<p>Test, which is a new approach to have</p>-->
                  <!--<span class="time_date"> 11:01 AM    |    Yesterday</span></div>-->
              <!--</div>-->
            <!--</div>-->

            <!--<div class="outgoing_msg">-->
              <!--<div class="sent_msg">-->
                <!--<p>Apollo University, Delhi, India Test</p>-->
                <!--<span class="time_date"> 11:01 AM    |    Today</span> </div>-->
            <!--</div>-->

            <!--<div class="incoming_msg">-->
              <!--<div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="profile"> </div>-->
              <!--<div class="received_msg">-->
                <!--<div class="received_withd_msg">-->
                  <!--<p>We work directly with our designers and suppliers,-->
                    <!--and sell direct to you, which means quality, exclusive-->
                    <!--products, at a price anyone can afford.</p>-->
                  <!--<span class="time_date"> 11:01 AM    |    Today</span></div>-->
              <!--</div>-->
            <!--</div>-->
          </div>


          <div class="type_msg">
            <div class="input_msg_write">
              <input type="text" class="write_msg" placeholder="Type a message" id="message_input" />
              <button class="msg_send_btn" type="button" id="msg_send"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
            </div>
          </div>
        </div>
      </div>


        <footer>
      <div class="container">
        <hr>
        <p>&copy; L2E 2019. All Rights Reserved.</p>
        <!--<ul class="list-inline">-->
          <!--<li class="list-inline-item">-->
            <!--<a href="#">Privacy</a>-->
          <!--</li>-->
          <!--<li class="list-inline-item">-->
            <!--<a href="#">Terms</a>-->
          <!--</li>-->
          <!--<li class="list-inline-item">-->
            <!--<a href="#">FAQ</a>-->
          <!--</li>-->
        <!--</ul>-->
      </div>
    </footer>

     <script type="text/javascript">
       var options = { month: 'long'};
      var month_str = new Intl.DateTimeFormat('en-US', options).format(new Date());
      month_str = month_str.slice(0, 3); // 'Mar', or 'Dec'
      var day_str = new Date().getDay();
      $("#active_chat_date").html(month_str + " " + day_str);

      function formatAMPM(date) {
          var hours = date.getHours();
          var minutes = date.getMinutes();
          var ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12;
          hours = hours ? hours : 12; // the hour '0' should be '12'
          minutes = minutes < 10 ? '0'+minutes : minutes;
          return hours + ':' + minutes + ' ' + ampm;
        }

      function post_l2e_message(message_str) {
          var time_str = formatAMPM(new Date);
          var e = $(" <div class=\"incoming_msg\">" +
              "              <div class=\"incoming_msg_img\"> <img src=\"https://ptetutorials.com/images/user-profile.png\" alt=\"profile\"></div>" +
              "              <div class=\"received_msg\">" +
              "                <div class=\"received_withd_msg\">" +
              "                  <p>" + message_str + "</p>" +
              "                  <span class=\"time_date\"> " + time_str + "    |    Today</span></div>" +
              "              </div>" +
              "            </div>");
          $('#msg_history_node').append(e);
          var objDiv = document.getElementById("msg_history_node");
          objDiv.scrollTop = objDiv.scrollHeight;
      }

      // we start by sending this message
      // 2 seconds delay
      setTimeout(function(){
        post_l2e_message("Hello! Please ask me to explain something!");
      }, 2000);

      function post_user_message(message_str) {
          var time_str = formatAMPM(new Date);
          var e = $("     <div class=\"outgoing_msg\">" +
            "              <div class=\"sent_msg\">" +
              "                  <p>" + message_str + "</p>" +
              "                  <span class=\"time_date\"> " + time_str + "    |    Today</span></div>" +
            "            </div>");
          $('#msg_history_node').append(e);
          var objDiv = document.getElementById("msg_history_node");
          objDiv.scrollTop = objDiv.scrollHeight;
      }

      // User interaction behavior

       function userEvent () {
        user_message = $("#message_input").val();
          if (user_message.endsWith(".")) {
              user_message = user_message.slice(0, user_message.length-1);
          }
          post_user_message(user_message);

          // Then we respond based on user behavior:
          // 1. string too long (longer than 50 words)
          if (user_message.split(' ').length > 50) {
              post_l2e_message("Sorry, we cannot handle a phenomenon longer than 50 words due to our system's memory limit.");
              return  //no follow up processing
          }

          if (user_message.trim().endsWith("because?") || user_message.trim().endsWith("because ?") || user_message.trim().startsWith("Why") || user_message.trim().startsWith("why")) {

               var is_why = user_message.trim().startsWith("Why") || user_message.trim().startsWith("why");  // pass to server
               var inp = {"text": user_message, "is_why": is_why};
               $.ajax({
                      // url: 'http://3.18.91.191/api/decode',  //real server address: http://18.222.239.24
                      url: "{{ url_for('decode') }}",  //real server address: http://18.222.239.24
                      type: 'POST',
                      data: JSON.stringify(inp),
                      contentType: 'application/json; charset=utf-8',
                      dataType: 'json',
                      async: true,
                      success: function(msg) {
                          // console.log(msg['output_html'])
                          post_l2e_message("We see your text as: " + msg['src']);
                          post_l2e_message("Our response is: " + msg['tgt']);
                      }
                  });

          } else {
              // 2. Did not end with "because" or start with "Why"
              // failure case
              post_l2e_message("Sorry, you need to start your message with 'Why'/'why' or end your sentence with 'because?'");
              return;
          }
          // 3. Maybe add other checks...?
      }

      $("#msg_send").click(userEvent);
      $("#message_input").bind("keypress", function(e) {
           if (e.keyCode === 13) {
              userEvent();
              $("#message_input").val("");
              return false; // ignore the default event
           }
        });

     </script>
</body>
</html>